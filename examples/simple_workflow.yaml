name: simple_data_pipeline
version: "1.0"
description: "Simple data processing pipeline for demonstration"
start_state: fetch_data
end_states: [notify_complete]

metadata:
  author: "Workflow CLI Demo"
  created: "2025-01-20"
  tags: ["demo", "simple", "data"]

states:
  fetch_data:
    type: task
    description: "Fetch data from external API"
    config:
      plugin: "http_client"
      url: "https://jsonplaceholder.typicode.com/posts"
      method: "GET"
      timeout: 30
    transitions:
      - validate_data
    resources:
      cpu_units: 1.0
      memory_mb: 512
    retries: 3

  validate_data:
    type: task
    description: "Validate the fetched data"
    config:
      plugin: "data_validator"
      rules:
        - "not_empty"
        - "json_format"
        - "required_fields"
    dependencies: [fetch_data]
    transitions:
      - target: process_data
        condition: "validation.passed"
      - target: handle_errors
        condition: "not validation.passed"
    resources:
      cpu_units: 1.0
      memory_mb: 256

  process_data:
    type: task
    description: "Process and transform the data"
    config:
      plugin: "data_processor"
      operations:
        - "clean_text"
        - "extract_keywords"
        - "format_output"
    dependencies: [validate_data]
    transitions:
      - store_data
    resources:
      cpu_units: 2.0
      memory_mb: 1024

  store_data:
    type: task
    description: "Store processed data"
    config:
      plugin: "storage_client"
      destination: "file://./output/processed_data.json"
      format: "json"
    dependencies: [process_data]
    transitions:
      - notify_complete
    resources:
      cpu_units: 1.0
      memory_mb: 256

  handle_errors:
    type: task
    description: "Handle validation errors"
    config:
      plugin: "error_handler"
      action: "log_and_notify"
      log_level: "ERROR"
    transitions:
      - notify_complete

  notify_complete:
    type: task
    description: "Send completion notification"
    config:
      plugin: "notifier"
      message: "Data pipeline completed"
      channels: ["console", "file"]
    dependencies: [store_data, handle_errors]